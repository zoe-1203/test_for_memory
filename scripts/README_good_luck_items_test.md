# 年运幸运物匹配概率测试

## 功能说明

这个脚本用于测试年运功能中11个幸运物的匹配概率分布。通过多次调用API，统计每个幸运物被选中的概率。

## 11个幸运物列表

1. 白水晶（关键词：综合平衡、净化、专注）
2. 粉水晶（关键词：桃花、人缘、治愈）
3. 黑曜石（关键词：防小人、健康、辟邪）
4. 黄水晶（关键词：搞钱、事业、自信）
5. 香薰蜡烛（关键词：动力、愿望显化、温暖）
6. 扩香石（关键词：焦虑、失眠、潜意识）
7. 鼠尾草（关键词：倒霉、净化环境、重启）
8. 干花香囊（关键词：贵人、出行、气质）
9. 捕梦网（关键词：噩梦、迷茫、守护）
10. 多肉植物（关键词：扎根、耐心、稳重）
11. 幸运御守（关键词：特定加持、信念、考试/交通）

## 使用前准备

### 1. 环境要求

- Node.js 18 或更高版本
- 开发服务器需要运行中

### 2. 启动开发服务器

```bash
npm run dev
```

确保服务器在 `http://localhost:3000` 运行（或修改脚本中的 `baseURL`）

### 3. 环境变量

确保以下环境变量已设置（在 `.env.local` 文件中）：

- `OPENAI_API_KEY`（如果使用 openai provider）
- `DEEPSEEK_API_KEY`（如果使用 deepseek provider）
- `DEEPSEEK_BASE_URL`（可选，默认: https://api.deepseek.com/v1）

## 使用方法

### 基本用法

```bash
# 默认测试20次，使用 deepseek 模型
node scripts/test_good_luck_items.js

# 测试50次
node scripts/test_good_luck_items.js 50

# 测试20次，使用 openai 模型
node scripts/test_good_luck_items.js 20 openai

# 测试100次，使用 deepseek 模型
node scripts/test_good_luck_items.js 100 deepseek
```

### 参数说明

1. **测试次数**（可选，默认：20）
   - 指定要执行的测试次数
   - 建议：20-100次可以获得较准确的概率分布

2. **provider**（可选，默认：deepseek）
   - `deepseek`：使用 DeepSeek 模型
   - `openai`：使用 OpenAI 模型

## API 需要的参数

脚本会自动准备以下参数：

### 1. `decemberContent`（必需）
- 类型：`string`
- 说明：十二月运势的 content 字段
- 示例脚本中使用的是示例数据，你可以根据需要修改

### 2. `areas`（必需）
- 类型：`Array<AreaInfo>`
- 说明：六大领域的解读信息数组
- 每个领域包含：
  - `areaName`: 领域名称（如 "感情"、"事业·学业"）
  - `hookSentece`: 一句话主命题
  - `content`: 解读内容
  - `summaryHighlight`: 关键提醒

### 3. `provider`（可选）
- 类型：`"openai" | "deepseek"`
- 默认值：`"openai"`
- 说明：使用的AI模型提供商

## 输出结果

### 控制台输出

脚本会在控制台显示：
- 实时测试进度
- 每次测试返回的幸运物
- 最终统计结果（次数、概率、可视化条形图）
- 详细结果列表

### 结果文件

测试结果会保存到 `data/good_luck_items_test_result_[timestamp].json`，包含：
- 测试配置信息
- 每个幸运物的出现次数和概率
- 所有测试的详细结果列表

### 结果示例

```
============================================================
测试结果统计
============================================================
总测试次数: 20
成功次数: 20
失败次数: 0
成功率: 100.00%

============================================================
幸运物概率分布:
============================================================
白水晶    |   5次 | 25.00% | ████████████
粉水晶    |   3次 | 15.00% | ███████
黄水晶    |   2次 | 10.00% | █████
...
```

## 修改测试数据

如果需要使用不同的测试数据，可以编辑 `scripts/test_good_luck_items.js` 文件中的：

- `DECEMBER_CONTENT`：修改十二月运势内容
- `AREAS`：修改六大领域的解读信息

## 注意事项

1. **API调用频率**：脚本在每次调用之间会等待1秒，避免请求过快
2. **成本考虑**：每次测试都会调用AI API，注意API使用成本
3. **结果随机性**：由于使用了 temperature=0.8，结果会有一定的随机性
4. **网络连接**：确保可以访问开发服务器和AI API

## 故障排除

### 错误：无法连接到服务器

**原因**：开发服务器未运行

**解决**：
```bash
npm run dev
```

### 错误：API返回错误

**原因**：可能是API密钥未设置或无效

**解决**：检查 `.env.local` 文件中的API密钥配置

### 错误：需要 Node.js 18 或更高版本

**原因**：Node.js版本过低

**解决**：升级Node.js到18或更高版本

